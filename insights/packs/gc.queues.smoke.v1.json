{
  "id": "gc.queues.smoke.v1",
  "name": "Queue Smoke Detector",
  "version": "1.0.1",
  "maturity": "alpha",
  "owner": "Ops Insights",
  "expectedRuntimeSec": 60,
  "description": "Ranks queues and agents by failure indicators for a time window using the existing smoke report function.",
  "scopes": ["analytics:read"],
  "tags": ["queues", "operations", "triage"],
  "examples": [
    {
      "title": "Top 10 offenders",
      "notes": "Use a week window via the UI Window preset; this example sets topN.",
      "parameters": {
        "topN": 10
      }
    }
  ],
  "parameters": {
    "startDate": {
      "type": "string",
      "required": true,
      "description": "ISO-8601 UTC start timestamp (e.g. 2025-12-01T00:00:00Z)."
    },
    "endDate": {
      "type": "string",
      "required": true,
      "description": "ISO-8601 UTC end timestamp (e.g. 2025-12-08T00:00:00Z)."
    },
    "topN": {
      "type": "int",
      "default": 10,
      "description": "How many queues/agents to rank."
    }
  },
  "pipeline": [
    {
      "id": "smoke",
      "type": "compute",
      "script": "param($ctx)\n# Build Genesys 'interval' range\n$interval = \"$($ctx.Parameters.startDate)/$($ctx.Parameters.endDate)\"\nGet-GCQueueSmokeReport -Interval $interval -TopN ([int]$ctx.Parameters.topN)\n"
    },
    {
      "id": "metricQueues",
      "type": "metric",
      "script": "param($ctx)\n$top = @($ctx.Data.smoke.QueueTop)\n[pscustomobject]@{ title='Top Queues (Abandon/Error)'; value=$top.Count; items=$top }\n"
    },
    {
      "id": "metricAgents",
      "type": "metric",
      "script": "param($ctx)\n$top = @($ctx.Data.smoke.AgentTop)\n[pscustomobject]@{ title='Top Agents (Abandon/Error)'; value=$top.Count; items=$top }\n"
    }
  ]
}
