{
  "id": "gc.dataActions.failures.v1",
  "name": "Data Action Failure Hotspots",
  "version": "1.0.0",
  "maturity": "alpha",
  "owner": "Ops Insights",
  "expectedRuntimeSec": 60,
  "description": "Finds the highest-impact Data Actions failures by time window and summarizes likely blast radius.",
  "scopes": ["analytics:read"],
  "tags": [
    "data-actions",
    "integrations",
    "reliability"
  ],
  "examples": [
    {
      "title": "Hourly top failures",
      "notes": "Use a 7-day or month window via the UI Window preset; this example sets granularity + topN.",
      "parameters": {
        "granularity": "PT1H",
        "topN": 10
      }
    }
  ],
  "parameters": {
    "startDate": {
      "type": "string",
      "required": true,
      "description": "ISO-8601 UTC start timestamp (e.g. 2025-12-01T00:00:00Z)."
    },
    "endDate": {
      "type": "string",
      "required": true,
      "description": "ISO-8601 UTC end timestamp (e.g. 2025-12-08T00:00:00Z)."
    },
    "granularity": {
      "type": "string",
      "default": "PT1H",
      "description": "Analytics aggregation granularity (e.g. PT15M, PT1H, P1D)."
    },
    "topN": {
      "type": "int",
      "default": 10,
      "description": "How many actions to return."
    }
  },
  "pipeline": [
    {
      "id": "actionsAgg",
      "type": "gcRequest",
      "method": "POST",
      "uri": "/api/v2/analytics/actions/aggregates/query",
      "bodyTemplate": {
        "interval": "{{startDate}}/{{endDate}}",
        "granularity": "{{granularity}}",
        "filter": {
          "type": "or",
          "clauses": []
        },
        "metrics": [
          "oTotalCount",
          "oErrorCount"
        ],
        "groupBy": [
          "actionId"
        ],
        "timeZone": "UTC"
      }
    },
    {
      "id": "topFailures",
      "type": "compute",
      "script": "param($ctx)\n$rows = @($ctx.Data.actionsAgg.results)\n$rows | Sort-Object -Property { $_.data.oErrorCount } -Descending | Select-Object -First ([int]$ctx.Parameters.topN)\n"
    },
    {
      "id": "metricFailures",
      "type": "metric",
      "script": "param($ctx)\n$items = @($ctx.Data.topFailures)\n[pscustomobject]@{\n  title='Top Data Actions by Error Count'\n  value=$items.Count\n  items=$items\n}\n"
    }
  ]
}
